import{q as b,r as p,j as e,Y as E}from"./app-Dy0cI71S.js";import{M as P}from"./MarcomLayout-BpqUUICF.js";import{W as L}from"./index-Cbf_8L7N.js";import"./index-BPMRSKcZ.js";var v="https://js.stripe.com/v3",T=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,y="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",R=function(){for(var t=document.querySelectorAll('script[src^="'.concat(v,'"]')),r=0;r<t.length;r++){var s=t[r];if(T.test(s.src))return s}return null},j=function(t){var r="",s=document.createElement("script");s.src="".concat(v).concat(r);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(s),s},C=function(t,r){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"5.4.0",startTime:r})},l=null,m=null,u=null,D=function(t){return function(){t(new Error("Failed to load Stripe.js"))}},I=function(t,r){return function(){window.Stripe?t(window.Stripe):r(new Error("Stripe.js not available"))}},F=function(t){return l!==null?l:(l=new Promise(function(r,s){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe&&t&&console.warn(y),window.Stripe){r(window.Stripe);return}try{var n=R();if(n&&t)console.warn(y);else if(!n)n=j(t);else if(n&&u!==null&&m!==null){var a;n.removeEventListener("load",u),n.removeEventListener("error",m),(a=n.parentNode)===null||a===void 0||a.removeChild(n),n=j(t)}u=I(r,s),m=D(s),n.addEventListener("load",u),n.addEventListener("error",m)}catch(d){s(d);return}}),l.catch(function(r){return l=null,Promise.reject(r)}))},q=function(t,r,s){if(t===null)return null;var n=t.apply(void 0,r);return C(n,s),n},c,w=!1,S=function(){return c||(c=F(null).catch(function(t){return c=null,Promise.reject(t)}),c)};Promise.resolve().then(function(){return S()}).catch(function(i){w||console.warn(i)});var W=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];w=!0;var n=Date.now();return S().then(function(a){return q(a,r,n)})};function G({legalnar:i,attendee:t}){const{stripe_key:r}=b().props,[s,n]=p.useState(!1),[a,d]=p.useState(null);p.useEffect(()=>{h()},[]);const h=async()=>{try{if(n(!0),d(null),!r)throw new Error("Stripe key not found");console.log("Initializing payment with Stripe key:",r);const o=await fetch(route("legalnars.payment.process",t.id),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!o.ok){const N=await o.json();throw new Error(N.error||"Payment initialization failed")}const{sessionId:x}=await o.json();if(!x)throw new Error("No session ID received from server");console.log("Got session ID:",x);const f=await W(r);if(!f)throw new Error("Failed to load Stripe");console.log("Redirecting to Stripe checkout...");const{error:g}=await f.redirectToCheckout({sessionId:x});if(g)throw g}catch(o){console.error("Payment initialization error:",o),d(o.message||"Unable to process payment. Please try again later.")}finally{n(!1)}};return e.jsxs(P,{children:[e.jsx(E,{title:"Complete Payment"}),e.jsx("div",{className:"bg-white py-24 sm:py-32",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-6 lg:px-8",children:[e.jsxs("div",{className:"mx-auto max-w-2xl text-center",children:[e.jsx("h2",{className:"text-3xl font-heading font-bold tracking-tight text-cod-gray sm:text-4xl",children:"Complete Your Registration"}),e.jsx("p",{className:"mt-2 text-lg leading-8 text-cod-gray-light",children:s?"Initializing payment...":"Please complete your payment to confirm your registration for "+i.title}),a&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 text-red-700 rounded-lg",children:a})]}),e.jsx("div",{className:"mt-16",children:e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-8 max-w-xl mx-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-heading font-semibold text-cod-gray",children:"Registration Details"}),e.jsxs("dl",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-cod-gray-light",children:"Session"}),e.jsx("dd",{className:"font-medium text-cod-gray",children:i.title})]}),i.scheduled_start&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-cod-gray-light",children:"Date"}),e.jsx("dd",{className:"font-medium text-cod-gray",children:new Date(i.scheduled_start).toLocaleDateString()})]}),i.scheduled_start&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-cod-gray-light",children:"Time"}),e.jsx("dd",{className:"font-medium text-cod-gray",children:new Date(i.scheduled_start).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-cod-gray-light",children:"Type"}),e.jsxs("dd",{className:"font-medium text-cod-gray capitalize",children:[i.type," Session"]})]})]})]}),e.jsxs("div",{className:"border-t border-gray-100 pt-6",children:[e.jsx("h4",{className:"text-lg font-heading font-semibold text-cod-gray",children:"Payment Summary"}),e.jsxs("div",{className:"mt-6 flex flex-col gap-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-cod-gray-light",children:"Registration Fee"}),e.jsxs("span",{className:"font-medium text-cod-gray",children:["$",parseFloat(i.price).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between border-t border-gray-100 pt-4 font-heading font-semibold text-cod-gray",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",parseFloat(i.price).toFixed(2)]})]})]}),e.jsxs("div",{className:"mt-8",children:[a&&e.jsx(L,{onClick:h,disabled:s,className:"w-full justify-center bg-cod-gray text-white hover:bg-cod-gray-light",children:"Try Again"}),e.jsx("p",{className:"mt-4 text-center text-sm text-cod-gray-light",children:"Secure payment processed by Stripe"})]})]})]})})})]})})]})}export{G as default};
